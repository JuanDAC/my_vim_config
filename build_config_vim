#!/usr/bin/env bash

readonly PATH_HOME="${HOME}/"
readonly PATH_INIT="${HOME}/.config/vim/"
readonly PATH_SRC="${HOME}/.vim/src/"
readonly PATH_SRC_UTILS="${HOME}/.vim/src/utils/"
readonly PATH_SRC_SETTING_PLUGINS="${HOME}/.vim/src/setting_plugins/"

if [ "$(which nvim | wc --bytes)" -eq 0 ]; then
	sudo apt-get update \
		; apt-get -y install neovim \
		; sudo apt-get -y install python-neovim \
		; sudo apt-get -y install python3-neovim
fi
if [ "$(which nvim | wc --bytes)" -eq 0 ]; then
	sudo apt update \
	 	; apt -y install neovim \
		; sudo apt -y install python-neovim \
		; sudo apt -y install python3-neovim
fi
if [ "$(which nvim | wc --bytes)" -eq 0 ]; then
	curl -LO https://github.com/neovim/neovim/releases/latest/download/nvim.appimage
	sudo chmod +x nvim.appimage
	./nvim.appimage --appimage-extract
	./squashfs-root/AppRun --version
	sudo mv squashfs-root / && ln -s /squashfs-root/AppRun /usr/bin/nvim
fi


readonly PATH_FILES=('events.vim' 'features.vim' 'index.vim' 'load_plugins.vim' \
'scheme.vim' 'settings.vim' 'variables.vim' 'mappings.vim' \
'setting_plugins/ale.vim' 'setting_plugins/coc.vim' 'setting_plugins/emmet.vim' \
'setting_plugins/index.vim' 'setting_plugins/nerd_tree.vim' \
'utils/index.vim' 'utils/string.vim')

rm -rf $PATH_SRC
rm -f "${PATH_HOME}.vimrc"
rm -f "${PATH_SRC}init.vim"

mkdir -p $PATH_HOME
mkdir -p $PATH_INIT
mkdir -p $PATH_SRC
mkdir -p $PATH_SRC_UTILS
mkdir -p $PATH_SRC_SETTING_PLUGINS

wget --directory-prefix=$PATH_INIT 'https://raw.githubusercontent.com/JuanDAC/my_vim_config/main/init.vim'
wget --directory-prefix=$PATH_HOME 'https://raw.githubusercontent.com/JuanDAC/my_vim_config/main/.vimrc'

for i in ${!PATH_FILES[@]}; do
	wget -O "${PATH_SRC}${PATH_FILES[$i]}" \
		"https://raw.githubusercontent.com/JuanDAC/my_vim_config/main/src/${PATH_FILES[$i]}"
done

if [ "$(which nvim | wc --bytes)" -eq 0 ]; then
	if [ ! -f "~/.vim/autoload/plug.vim" ]; then
		curl -fLo ~/.vim/autoload/plug.vim --create-dirs \
			https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
	fi
else
	if [ ! -f "${XDG_DATA_HOME:-$HOME/.local/share}/nvim/site/autoload/plug.vim" ]; then
		sh -c 'curl -fLo "${XDG_DATA_HOME:-$HOME/.local/share}"/nvim/site/autoload/plug.vim --create-dirs \
			https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim'
	fi
	
	if [ "$(cat ~/.bash_aliases | grep "vim='nvim';alias rm='rm -i'" | wc --bytes)" -ne 0 ]; then
		echo "alias vim='nvim';alias rm='rm -i'" >> ~/.bash_aliases
	fi
fi

if [ "$(cat ~/.bashrc | grep "build_config_vim" | wc --bytes)" -eq 0 ]; then
	echo "wget -O - https://raw.githubusercontent.com/JuanDAC/my_vim_config/main/build_config_vim" >> ~/.bashrc
fi

